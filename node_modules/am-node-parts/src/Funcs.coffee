fs = require("fs")
isjs = require("is_js")

module.exports = class Funcs
  #about dir tree event
  ignore_regexp: /(\/node_modules\/(?!am-).+\/node_modules\/)|(\/\.[^\/]+\/)/
  check_dir_tree: (dir, pattern, callback) =>
    files = fs.readdirSync(dir)
    for file in files
      loc = "#{dir}#{file}"
      if loc.match(@ignore_regexp) then continue
      if fs.lstatSync(loc).isDirectory()
        @check_dir_tree("#{loc}/", pattern, callback)
      else
        unless loc.match(pattern) then continue
        console.log file
        callback(loc, file)
  watch_dir_tree: (dir, pattern, callback) =>
    files = fs.readdirSync(dir)
    for file in files
      loc = "#{dir}#{file}"
      if loc.match(@ignore_regexp) then continue
      if fs.lstatSync(loc).isDirectory()
        do (dir = "#{loc}/" ) =>
          @watch_dir_tree(dir, pattern, callback)
          if @_pattern_check(dir, pattern) then fs.watch(dir, (event, name) => callback(dir, event, name))
  _pattern_check: (word, pattern) ->
    if isjs.array(pattern)
      return true for regex in pattern when word.match(regex)
    else
      return true if word.match(pattern)
    return false
  #mkdirp
