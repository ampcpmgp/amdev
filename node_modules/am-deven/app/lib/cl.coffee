#config
interval = 5 * 60000# / 60  # テスト時は５秒に１回
#vars
exec = require("child_process").exec
proc = null
start = -> proc = exec("npm run start", (e,o,i) -> console.log(e,o,i))
check = -> do(check) ->
  check = exec("git pull origin")
  check.stdout.on("data", (data) ->
    console.log new Date(), data
    unless data.match("Already up-to-date")# or false #強制稼働
      console.log("kill")
      proc.stdin.pause()
      proc.kill("SIGKILL")
      callback = ->
        start()
        cl()
      return setTimeout(callback, 3000) #3秒待機し再起動
    cl()
  )
cl = -> setTimeout(check, interval)
#exe
start()
cl()
