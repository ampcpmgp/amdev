babel = require("babel")
exec = require("child_process").exec
fs = require("fs")

module.exports = class CompilerSrc
  log: (msg) =>
    try
      process.send(msg)
    catch e
      console.log(msg)
  compile_coffee: (filepath) =>
    output = filepath.replace(/([\\|\/])src([\\|\/])/, "$1lib$2").replace(/[^\\|\/]+.coffee$/, "")
    command = "coffee  -o #{output} -cm #{filepath}"
    exec(command, (e, stdout, stderr) =>
      if e then return CompilerSrc.prototype.log(stderr.replace(/.*:([0-9]+:[0-9]+.*)/, "$1"))
      CompilerSrc.prototype.log("compile #{filepath}")
    )
  compile_sass: (filepath) =>
    command = "sass #{filepath} #{filepath.replace(/([\\|\/])src([\\|\/])/, $1css$2).replace(/sass$/, 'css')}"
    try
      exec(command, (e, stdout, stderr) =>
        if(e) then return CompilerSrc.prototype.log(stderr)
        CompilerSrc.prototype.log("compile #{filepath}")
        )
     catch e
      CompilerSrc.prototype.log(e.message)



###
CompilerSrc.prototype.compile_coffee("./src/main.coffee")
CompilerSrc.prototype.compile_sass("./src/default.sass")
###
